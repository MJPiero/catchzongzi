function game_in(){console.log("进入游戏"),createjs.Ticker.setPaused(!1),createjs.Sound.registerSound("./images/game-bgm.mp3","game-bgm"),createjs.Sound.on("fileload",function(){createjs.Sound.play("game-bgm",{interrupt:createjs.Sound.INTERRUPT_ANY,loop:-1,volume:.1})},this);var e=new createjs.Bitmap(preload.getResult("game-bg"));e.scaleX=win_W/e.image.width,e.scaleY=win_H/e.image.height,game_container=new createjs.Container,game_container.addChild(e),game_container.alpha=0,stage.addChild(game_container);new TWEEN.Tween(game_container).to({alpha:1},500).onComplete(function(){game_begin()}).start()}function game_begin(){zongzi_sprite.load(),basket_sprite.load(),game_score.load(),time_sprite.load(),tt_game=setTimeout(function(){game_over()},1e3*(time_sprite.GAME_TIME+1))}function game_over(){window.clearInterval(ti_zongzi),window.clearInterval(ti_bomb),window.clearInterval(ti_time),window.clearTimeout(tt_game),createjs.Ticker.setPaused(!0),TWEEN.removeAll(),game_score.score_zongzi<30?game_fail():game_success()}function game_fail(){var e=new createjs.Container,t=new createjs.Shape;t.graphics.beginFill("#000"),t.graphics.drawRect(0,0,win_W,win_H),t.graphics.endFill(),t.alpha=.6;var a=new createjs.Bitmap(preload.getResult("gamefail-bg"));a.scaleX=a.scaleY=win_W/a.image.width*.8,a.x=(win_W-a.image.width*a.scaleX)/2,a.y=.2*win_H;var n=new createjs.Bitmap(preload.getResult("restart-button"));n.scaleX=n.scaleY=win_W/n.image.width*.3,n.x=a.x+10,n.y=a.y+a.image.height*a.scaleY*.75;var i=new createjs.Bitmap(preload.getResult("share-button"));i.scaleX=i.scaleY=win_W/i.image.width*.3,i.x=a.x+a.image.width*a.scaleX-i.image.width*i.scaleX-20,i.y=a.y+a.image.height*a.scaleY*.75,e.addChild(t,a,n,i),game_container.addChild(e),stage.update(),n.on("pressup",function(){game_restart()}),i.on("pressup",function(){openshare()})}function game_success(){var e=new createjs.Container,t=new createjs.Shape;if(t.graphics.beginFill("#000"),t.graphics.drawRect(0,0,win_W,win_H),t.graphics.endFill(),t.alpha=.6,0==game_flag){var a=new createjs.DOMElement(document.getElementById("success_send"));$("#success_send").show(),document.getElementById("restart").addEventListener("click",function(){$("#success_send").hide(),game_restart()}),document.getElementById("share").addEventListener("click",function(){$("#success_send").hide(),openshare()}),e.addChild(t,a)}else if(1==game_flag){var n=new createjs.Bitmap(preload.getResult("success-bg2"));n.scaleX=n.scaleY=win_W/n.image.width*.8,n.x=(win_W-n.image.width*n.scaleX)/2,n.y=.2*win_H;var i=new createjs.Bitmap(preload.getResult("restart-button"));i.scaleX=i.scaleY=win_W/i.image.width*.3,i.x=(win_W-i.image.width*i.scaleX)/2,i.y=n.y+n.image.height*n.scaleY*.65,i.addEventListener("click",function(){game_restart()}),e.addChild(t,n,i)}game_container.addChild(e),stage.update()}function game_restart(){console.log("游戏重新开始"),createjs.Sound.removeSound("game-bgm"),zongzi_sprite.zongzi_container.removeAllChildren(),game_container.removeAllChildren(),stage.removeChild(game_container),game_in()}function openshare(){var e=new createjs.Container,t=new createjs.Shape;t.graphics.beginFill("#000"),t.graphics.drawRect(0,0,win_W,win_H),t.graphics.endFill(),t.alpha=.6;var a=new createjs.Bitmap(preload.getResult("share-img"));a.scaleX=a.scaleY=win_W/a.image.width*.5,a.x=win_W-a.image.width*a.scaleX-10,a.y=20,e.addChild(t,a),game_container.addChild(e),stage.update(),e.on("pressup",function(){$("#success_send").show(),e.removeAllChildren(),game_container.removeChild(e),stage.update()})}function init(){console.log("游戏初始化"),canvas=document.getElementById("gameCanvas"),stage=new createjs.Stage(canvas),stage.canvas.width=win_W,stage.canvas.height=win_H;var e=new createjs.LoadQueue;e.loadFile({id:"logo",src:"./images/logo.png",type:createjs.AbstractLoader.IMAGE}),e.loadFile({id:"loadbg",src:"./images/load-bg.jpg",type:createjs.AbstractLoader.IMAGE}),e.on("complete",function(t){var a=new createjs.Bitmap(e.getResult("loadbg"));a.scaleX=win_W/a.image.width,a.scaleY=win_H/a.image.height;var n=new createjs.Text("0%","bold 1rem Arial","#a74510"),i=new createjs.Bitmap(e.getResult("logo"));n.maxWidth=win_W,n.textAlign="center",n.textBaseline="middle",n.x=win_W/2,n.y=win_H/2,i.scaleX=i.scaleY=.7*win_W/i.image.width,i.x=win_W/2-i.image.width*i.scaleX/2,i.y=win_H/2-i.image.height*i.scaleY-20;var s=new createjs.Container;s.addChild(a,i,n),s.alpha=1,stage.addChild(s),createjs.Ticker.setFPS(GAME_FPS),createjs.Ticker.addEventListener("tick",handleTick),createjs.Touch.enable(stage,!0),stage.enableMouseOver(10),stage.mouseMoveOutside=!0,createjs.Sound.registerPlugins([createjs.WebAudioPlugin]),createjs.Sound.alternateExtensions=["mp3"],preload=new createjs.LoadQueue,preload.installPlugin(createjs.Sound),preload.loadManifest([{id:"start-bg",src:"./images/start-bg.jpg"},{id:"start-button",src:"./images/start-button.png"},{id:"game-bg",src:"./images/game-bg.jpg"},{id:"zongzi1",src:"./images/zongzi1.png"},{id:"zongzi2",src:"./images/zongzi2.png"},{id:"zongzi3",src:"./images/zongzi3.png"},{id:"bomb",src:"./images/bomb.png"},{id:"basket",src:"./images/basket.png"},{id:"number",src:"./images/number.png"},{id:"score_best",src:"./images/score_best.png"},{id:"score_zongzi",src:"./images/score_zongzi.png"},{id:"time",src:"./images/time.png"},{id:"text",src:"./images/text.png"},{id:"gamefail-bg",src:"./images/game-fail.png"},{id:"restart-button",src:"./images/restart-button.png"},{id:"success-bg",src:"./images/success-bg.png"},{id:"success-bg2",src:"./images/success-bg2.png"},{id:"label-name",src:"./images/label-name.png"},{id:"label-phone",src:"./images/label-phone.png"},{id:"label-company",src:"./images/label-company.png"},{id:"share-button",src:"./images/return-button.png"},{id:"send-button",src:"./images/send-button.png"},{id:"share-img",src:"./images/share.png"},{id:"game-bgm",src:"./images/game-bgm.mp3"}]),preload.on("progress",function(e){n.text=(100*preload.progress|0)+"%",stage.update()},this),preload.on("complete",function(e){new TWEEN.Tween(s).to({alpha:0,visible:!0},500).onComplete(function(){createjs.Ticker.setPaused(!0),stage.clear(),gamestart()}).start()},this)},this)}function handleTick(e){e.paused||(stage.update(),TWEEN.update())}function gamestart(){console.log("开始游戏界面");var e=new createjs.Bitmap(preload.getResult("start-bg"));startbutton=new createjs.Bitmap(preload.getResult("start-button")),e.scaleX=win_W/e.image.width,e.scaleY=win_H/e.image.height,startbutton.scaleX=.6*win_W/startbutton.image.width,startbutton.scaleY=startbutton.scaleX,startbutton.x=win_W/2-startbutton.image.width*startbutton.scaleX/2,startbutton.y=win_H-startbutton.image.height*startbutton.scaleY*2,startbutton.cursor="pointer",start_container=new createjs.Container,start_container.addChild(e,startbutton),start_container.alpha=0,stage.addChild(start_container),createjs.Ticker.setPaused(!1);new TWEEN.Tween(start_container).to({alpha:1,visible:!0},500).onComplete(function(){gamestart_event()}).start()}function gamestart_event(){startbutton.on("mousedown",function(e){startbutton.y-=5}),startbutton.on("pressup",function(e){new TWEEN.Tween(startbutton).to({y:this.y+5},500).onComplete(function(){new TWEEN.Tween(start_container).to({alpha:0,visible:!0},500).onComplete(function(){game_in()}).start()}).start()})}var game_container,ti_zongzi,ti_bomb,ti_time,tt_game,game_flag=0,win_W=window.innerWidth,win_H=window.innerHeight;document.getElementsByClassName("body")[0].style.height=win_H+"px";var canvas,stage,preload,GAME_FPS=60;init();var zongzi_sprite={cot:0,Interval:{zongzi:500,bomb:700},zongzi_container:"",load:function(){var e=this;e.cot=0,e.zongzi_container=new createjs.Container,game_container.addChild(e.zongzi_container);for(var t=[],a=1;a<=3;a++)t.push(preload.getResult("zongzi"+a));ti_zongzi=setInterval(function(){var a=0|Math.floor(2*Math.random());e.create(t[a],"zongzi")},e.Interval.zongzi),ti_bomb=setInterval(function(){e.create(preload.getResult("bomb"),"bomb")},e.Interval.bomb)},create:function(e,t){var a=this,n=new createjs.Bitmap(e);n.scaleX=n.scaleY=n.scale=win_W/n.image.width/6,n.regX=n.image.width*n.scaleX/2|0,n.regY=n.image.height*n.scaleX/2|0,n.rotation=360*Math.random()|0,n.x=n.image.width*n.scaleX/2+(win_W-n.image.width*n.scaleX)*Math.random(),n.y=0-n.image.height*n.scaleY,n.name=t+"_"+a.cot,a.cot++,a.zongzi_container.addChild(n);new TWEEN.Tween(n).to({y:win_H-10},4500).easing(TWEEN.Easing.Cubic.In).onUpdate(function(){this.y>=basket_sprite.basket_el.y&&basket_sprite.hite_check(this.x,this.y,n,t)}).onComplete(function(){a.zongzi_container.removeChild(n)}).start()}},basket_sprite={basket_el:"",temp_el:"",getbitmap:function(){var e=new createjs.Bitmap(preload.getResult("basket"));return e},load:function(){this.create(),effect_sprite.container.addscore=new createjs.Container,game_container.addChild(effect_sprite.container.addscore)},create:function(){var e=this;e.basket_el=e.getbitmap(),e.basket_el.scaleX=e.basket_el.scaleY=win_W/4.5/e.basket_el.image.width,e.basket_el.x=win_W/2-e.basket_el.image.width*e.basket_el.scaleX/2,e.basket_el.y=win_H-e.basket_el.image.height*e.basket_el.scaleY,game_container.addChild(e.basket_el),e.drag(e.basket_el)},drag:function(e){e.on("mousedown",function(e){this.offset={x:this.x-e.stageX,y:this.y-e.stageY}}),e.on("pressmove",function(e){var t=this;e.stageX<=t.image.width*t.scaleX*.5?t.x=0:e.stageX>=win_W-t.image.width*t.scaleX*.5?t.x=win_W-t.image.width*t.scaleX:t.x=e.stageX+t.offset.x})},hite_check:function(e,t,a,n){var i=this;if(e>=i.basket_el.x&&e<=i.basket_el.x+i.basket_el.image.width*i.basket_el.scaleX){if(i.temp_el==a.name)return!1;if("bomb"==n)game_over();else{var s=i.basket_el.x,r=i.basket_el.y;effect_sprite.addscore(s,r);new TWEEN.Tween(i.basket_el).to({y:i.basket_el.y-10},200).onComplete(function(){new TWEEN.Tween(i.basket_el).to({y:win_H-i.basket_el.image.height*i.basket_el.scaleY},200).start()}).start();game_score.addscore()}return zongzi_sprite.zongzi_container.removeChild(a),i.temp_el=a.name,!0}}},game_score={score_zongzi:0,score_best:0,scale:0,zongziscore:{zongziscore_g:"",zongziscore_s:"",zongziscore_b:""},load:function(){var e=this;e.score_zongzi=0,game_container.addChild(e.loadbestscore(),e.loadzongziscore())},loadbestscore:function(){var e=this,t=new createjs.Container,a=new createjs.Bitmap(preload.getResult("score_best"));e.scale=a.scaleX=a.scaleY=win_W/a.image.width*.4,a.y=a.x=10;var n=e.resolvescore(e.score_best),i=new createjs.Sprite(effect_sprite.number_sprite(),"num_"+n[2]),s=new createjs.Sprite(effect_sprite.number_sprite(),"num_"+n[1]),r=new createjs.Sprite(effect_sprite.number_sprite(),"num_"+n[0]);return i.scaleX=i.scaleY=s.scaleX=s.scaleY=r.scaleX=r.scaleY=e.scale,i.y=s.y=r.y=17,i.x=a.x+a.image.width*e.scale*.6,s.x=i.x-20,r.x=s.x-20,t.addChild(a,i,s,r),t},loadzongziscore:function(){var e=this,t=new createjs.Container,a=new createjs.Bitmap(preload.getResult("score_zongzi"));e.scale=a.scaleX=a.scaleY=win_W/a.image.width*.4,a.x=10,a.y=a.image.height*e.scale+20;var n=e.resolvescore(e.score_zongzi),i=e.zongziscore.zongziscore_g=new createjs.Sprite(effect_sprite.number_sprite(),"num_"+n[2]),s=e.zongziscore.zongziscore_s=new createjs.Sprite(effect_sprite.number_sprite(),"num_"+n[1]),r=e.zongziscore.zongziscore_b=new createjs.Sprite(effect_sprite.number_sprite(),"num_"+n[0]);return i.scaleX=i.scaleY=s.scaleX=s.scaleY=r.scaleX=r.scaleY=e.scale,i.y=s.y=r.y=a.y+3,i.x=a.x+a.image.width*e.scale*.6,s.x=i.x-20,r.x=s.x-20,t.addChild(a,i,s,r),t},addscore:function(){var e=this;e.score_zongzi++;var t=e.resolvescore(e.score_zongzi);e.zongziscore.zongziscore_g.gotoAndStop("num_"+t[2]),e.zongziscore.zongziscore_s.gotoAndStop("num_"+t[1]),e.zongziscore.zongziscore_b.gotoAndStop("num_"+t[0])},resolvescore:function(e){var t=parseInt(e/100),a=parseInt((e-100*t)/10),n=(e-100*t)%10,i=[t,a,n];return i}},time_sprite={GAME_TIME:30,time:{g:0,s:0},load:function(){var e=this;e.GAME_TIME=30,game_container.addChild(e.create())},create:function(){var e=this,t=new createjs.Container,a=new createjs.Bitmap(preload.getResult("time"));a.scaleX=a.scaleY=win_W/a.image.width*.4,a.x=win_W-10-a.image.width*a.scaleX,a.y=10;var n=new createjs.Bitmap(preload.getResult("text"));return n.scaleX=n.scaleY=a.scaleX,n.x=a.x+a.image.width*a.scaleX*.6,n.y=a.y+8,e.time.g=new createjs.Sprite(effect_sprite.number_sprite(),"num_0"),e.time.s=new createjs.Sprite(effect_sprite.number_sprite(),"num_3"),e.time.g.scaleX=e.time.g.scaleY=e.time.s.scaleX=e.time.s.scaleY=a.scaleX,e.time.g.y=e.time.s.y=a.y+7,e.time.g.x=n.x-30,e.time.s.x=e.time.g.x-20,t.addChild(a,e.time.g,e.time.s,n),e.countdown(),t},countdown:function(){var e=this;ti_time=setInterval(function(){e.GAME_TIME--;var t=e.resolvescore(e.GAME_TIME);e.time.g.gotoAndStop("num_"+t[1]),e.time.s.gotoAndStop("num_"+t[0])},1e3)},resolvescore:function(e){var t=parseInt(e/10),a=e%10,n=[t,a];return n}},effect_sprite={container:{addscore:""},number_sprite:function(){var e=preload.getResult("number"),t=new createjs.SpriteSheet({framerate:GAME_FPS,animations:{num_0:0,num_1:1,num_2:2,num_3:3,num_4:4,num_5:5,num_6:6,num_7:7,num_8:8,num_9:9},images:[e],frames:{height:e.height,width:e.width/10,regX:0,regY:0,count:10}});return t},addscore:function(e,t){var a=this,n=new createjs.Text("+1","bold 1rem Arial","#f32b63");n.x=e+basket_sprite.basket_el.image.width*basket_sprite.basket_el.scaleX*.6,n.y=t-10,a.container.addscore.addChild(n);new TWEEN.Tween(n).to({alpha:0,y:n.y-20,x:n.x+20},1e3).onComplete(function(){a.container.addscore.removeChild(n)}).start()}},startbutton,listbutton,start_container;